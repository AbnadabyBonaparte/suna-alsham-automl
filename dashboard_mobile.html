<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ALSHAM QUANTUM - Enterprise Neural Platform</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#F4D03F">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ALSHAM QUANTUM">
    <meta name="application-name" content="ALSHAM QUANTUM">
    <meta name="msapplication-TileColor" content="#1a1a2e">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https: wss: data: blob:; connect-src 'self' https: wss: data:;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    
    <!-- CDN Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/countup.js@2.6.2/dist/countUp.umd.js"></script>

    <style>
        :root {
            /* ALSHAM QUANTUM Corporate Color Palette */
            --quantum-gold: #F4D03F;
            --quantum-blue: #1F618D;
            --quantum-purple: #6C3483;
            --corporate-dark: #2C3E50;
            --enterprise-green: #2ECC71;
            --platinum-white: #FDFEFE;
            --deep-space: #020C1B;
        }

        /* === QUANTUM GLASS THEME (DEFAULT) === */
        .theme-quantum-glass {
            --bg-primary: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            --bg-card: rgba(255, 255, 255, 0.1);
            --bg-secondary: rgba(0, 245, 255, 0.05);
            --text-primary: #ffffff;
            --text-secondary: #b0c4de;
            --accent-primary: var(--quantum-gold);
            --accent-secondary: var(--enterprise-green);
            --accent-tertiary: var(--quantum-purple);
            --border-glow: rgba(244, 208, 63, 0.3);
            --shadow-glow: 0 0 30px rgba(244, 208, 63, 0.2);
            --particles-color: #F4D03F;
        }

        /* === CORPORATE VOID THEME === */
        .theme-corporate-void {
            --bg-primary: linear-gradient(135deg, var(--deep-space) 0%, #1a0033 50%, #330066 100%);
            --bg-card: rgba(108, 52, 131, 0.2);
            --bg-secondary: rgba(156, 39, 176, 0.1);
            --text-primary: #e1bee7;
            --text-secondary: #ba68c8;
            --accent-primary: var(--quantum-purple);
            --accent-secondary: #9c27b0;
            --accent-tertiary: #673ab7;
            --border-glow: rgba(108, 52, 131, 0.5);
            --shadow-glow: 0 0 40px rgba(156, 39, 176, 0.3);
            --particles-color: #9c27b0;
        }

        /* === ENTERPRISE AZURE THEME === */
        .theme-enterprise-azure {
            --bg-primary: linear-gradient(135deg, #1a237e 0%, #283593 50%, #3f51b5 100%);
            --bg-card: rgba(31, 97, 141, 0.25);
            --bg-secondary: rgba(63, 81, 181, 0.1);
            --text-primary: #e8eaf6;
            --text-secondary: #9fa8da;
            --accent-primary: var(--quantum-blue);
            --accent-secondary: #3f51b5;
            --accent-tertiary: #2196f3;
            --border-glow: rgba(31, 97, 141, 0.4);
            --shadow-glow: 0 0 35px rgba(63, 81, 181, 0.25);
            --particles-color: #2196f3;
        }

        /* === QUANTUM MATRIX THEME === */
        .theme-quantum-matrix {
            --bg-primary: linear-gradient(135deg, #004d40 0%, #00695c 50%, #00796b 100%);
            --bg-card: rgba(46, 204, 113, 0.15);
            --bg-secondary: rgba(0, 245, 255, 0.08);
            --text-primary: #e0f2f1;
            --text-secondary: #80cbc4;
            --accent-primary: var(--enterprise-green);
            --accent-secondary: #00f5ff;
            --accent-tertiary: #1de9b6;
            --border-glow: rgba(46, 204, 113, 0.4);
            --shadow-glow: 0 0 30px rgba(0, 245, 255, 0.2);
            --particles-color: #00f5ff;
        }

        /* === PLATINUM EXECUTIVE THEME === */
        .theme-platinum-executive {
            --bg-primary: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 50%, #667eea 100%);
            --bg-card: rgba(255, 255, 255, 0.8);
            --bg-secondary: rgba(102, 126, 234, 0.05);
            --text-primary: var(--corporate-dark);
            --text-secondary: #546e7a;
            --accent-primary: var(--quantum-purple);
            --accent-secondary: var(--quantum-blue);
            --accent-tertiary: var(--quantum-gold);
            --border-glow: rgba(108, 52, 131, 0.3);
            --shadow-glow: 0 0 25px rgba(31, 97, 141, 0.15);
            --particles-color: #667eea;
        }

        /* === GLOBAL STYLES === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
            /* Safe Area Support */
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            /* PDF Optimization */
            print-color-adjust: exact;
            -webkit-print-color-adjust: exact;
        }

        .orbitron {
            font-family: 'Orbitron', monospace;
        }

        /* === PWA INSTALL PROMPT === */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-glow);
            border-radius: 15px;
            padding: 15px;
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .install-prompt.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* === CONNECTION STATUS === */
        .connection-status {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid var(--border-glow);
            z-index: 999;
            font-size: 14px;
            min-height: 44px; /* Touch target */
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff4444;
            animation: pulse 2s infinite;
        }

        .status-dot.connected {
            background: #44ff44;
        }

        /* === PARTICLES CONTAINER === */
        #particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        /* === MAIN CONTAINER === */
        .main-container {
            position: relative;
            z-index: 10;
            padding: 2rem 1rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* === GLASS MORPHISM === */
        .glass-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-glow);
            border-radius: 20px;
            box-shadow: var(--shadow-glow);
            transition: all 0.4s cubic-bezier(0.23, 1, 0.320, 1);
            position: relative;
            overflow: hidden;
            /* Touch optimization */
            touch-action: manipulation;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.8s;
        }

        .glass-card:hover::before,
        .glass-card:active::before {
            left: 100%;
        }

        /* === 3D CARD TRANSFORMATIONS === */
        .card-3d {
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.320, 1);
        }

        .card-3d:hover,
        .card-3d:active {
            transform: rotateX(5deg) rotateY(5deg) scale(1.02);
            z-index: 100;
        }

        /* === QUANTUM COUNTER === */
        .quantum-counter {
            position: relative;
            text-align: center;
            padding: 3rem 2rem;
            margin-bottom: 2rem;
        }

        .quantum-counter::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, var(--accent-primary), transparent);
            animation: rotate-glow 4s linear infinite;
            z-index: -1;
            border-radius: 50%;
        }

        .quantum-counter-number {
            font-family: 'Orbitron', monospace;
            font-size: clamp(2rem, 8vw, 4rem);
            font-weight: 900;
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary), var(--accent-tertiary));
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-shift 3s ease-in-out infinite, pulse-glow 2s ease-in-out infinite;
            text-shadow: 0 0 30px var(--accent-secondary);
        }

        /* === ANIMATIONS === */
        @keyframes rotate-glow {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes pulse-glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow-pulse {
            0%, 100% { box-shadow: var(--shadow-glow); }
            50% { box-shadow: 0 0 40px var(--accent-primary); }
        }

        /* === GRID LAYOUTS === */
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        /* === PROGRESS RINGS === */
        .progress-ring {
            width: 100px;
            height: 100px;
            position: relative;
        }

        .progress-ring circle {
            transition: stroke-dashoffset 0.6s ease-in-out;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        /* === THEME SWITCHER === */
        .theme-switcher {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .theme-btn {
            width: 44px; /* Touch target */
            height: 44px; /* Touch target */
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            touch-action: manipulation;
        }

        .theme-btn:hover,
        .theme-btn:active {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .theme-btn.active {
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px var(--accent-primary);
        }

        /* === EVENT LOG === */
        .event-log {
            max-height: 300px;
            overflow-y: auto;
        }

        .event-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            min-height: 48px; /* Touch target */
        }

        .event-item:hover,
        .event-item:active {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.1);
        }

        /* === MODAL STYLES === */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-glow);
            border-radius: 20px;
            padding: 2rem;
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            width: 100%;
            max-width: 600px;
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        /* === CHARTS CONTAINER === */
        .chart-container {
            position: relative;
            height: 300px;
            padding: 1rem;
        }

        /* === MICRO UPDATES === */
        .micro-update {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-primary);
            color: var(--deep-space);
            padding: 16px 24px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 16px;
            z-index: 3000;
            opacity: 0;
            scale: 0.5;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .micro-update.show {
            opacity: 1;
            scale: 1;
        }

        /* === BUTTONS & INTERACTIVE ELEMENTS === */
        button, .btn {
            min-height: 44px; /* Touch target */
            min-width: 44px; /* Touch target */
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid var(--border-glow);
            background: var(--bg-card);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
            backdrop-filter: blur(10px);
        }

        button:hover, button:active, .btn:hover, .btn:active {
            background: var(--accent-primary);
            color: var(--deep-space);
            transform: scale(0.98);
        }

        /* === RESPONSIVE DESIGN === */
        @media (max-width: 768px) {
            .main-container {
                padding: 1rem 0.5rem;
            }
            
            .quantum-counter {
                padding: 2rem 1rem;
            }
            
            .agent-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
            }
            
            .theme-switcher {
                position: relative;
                top: auto;
                right: auto;
                flex-direction: row;
                justify-content: center;
                margin-bottom: 1rem;
            }

            .connection-status {
                position: relative;
                top: auto;
                left: auto;
                margin-bottom: 1rem;
                justify-content: center;
            }

            .chart-container {
                height: 250px;
            }
        }

        @media (max-width: 480px) {
            .main-container {
                padding: 0.5rem 0.25rem;
            }
            
            .glass-card {
                border-radius: 15px;
                margin-bottom: 1rem;
            }
            
            .quantum-counter {
                padding: 1.5rem 0.5rem;
            }
            
            .progress-ring {
                width: 80px;
                height: 80px;
            }
        }

        /* === PRINT/PDF STYLES === */
        @media print {
            body {
                background: white !important;
                color: black !important;
            }
            
            .glass-card {
                background: rgba(0, 0, 0, 0.05) !important;
                border: 1px solid #ccc !important;
                box-shadow: none !important;
                break-inside: avoid;
            }
            
            .theme-switcher,
            .install-prompt,
            .connection-status,
            #particles-container {
                display: none !important;
            }
            
            .main-container {
                padding: 0 !important;
                max-width: none !important;
            }
        }

        /* === SCROLLBAR STYLING === */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-secondary);
        }

        /* === ACCESSIBILITY === */
        @media (prefers-reduced-motion: reduce) {
            *, ::before, ::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* === HIGH CONTRAST MODE === */
        @media (prefers-contrast: high) {
            .glass-card {
                border-width: 2px;
                background: rgba(255, 255, 255, 0.2);
            }
        }
    </style>
</head>
<body class="theme-quantum-glass">
    <!-- Particles System -->
    <div id="particles-container"></div>

    <!-- Connection Status -->
    <div class="connection-status">
        <div class="status-dot" id="connection-dot"></div>
        <span id="connection-text">Conectando...</span>
    </div>

    <!-- Theme Switcher -->
    <div class="theme-switcher">
        <div class="theme-btn active" data-theme="quantum-glass" style="background: linear-gradient(45deg, #1a1a2e, #F4D03F);" title="Quantum Glass" aria-label="Tema Quantum Glass"></div>
        <div class="theme-btn" data-theme="corporate-void" style="background: linear-gradient(45deg, #020C1B, #6C3483);" title="Corporate Void" aria-label="Tema Corporate Void"></div>
        <div class="theme-btn" data-theme="enterprise-azure" style="background: linear-gradient(45deg, #1F618D, #3f51b5);" title="Enterprise Azure" aria-label="Tema Enterprise Azure"></div>
        <div class="theme-btn" data-theme="quantum-matrix" style="background: linear-gradient(45deg, #2ECC71, #00f5ff);" title="Quantum Matrix" aria-label="Tema Quantum Matrix"></div>
        <div class="theme-btn" data-theme="platinum-executive" style="background: linear-gradient(45deg, #f5f7fa, #667eea);" title="Platinum Executive" aria-label="Tema Platinum Executive"></div>
    </div>

    <!-- PWA Install Prompt -->
    <div class="install-prompt" id="install-prompt">
        <div class="flex items-center justify-between">
            <div class="flex-1">
                <h3 class="font-bold text-lg">üì± Instalar ALSHAM QUANTUM</h3>
                <p class="text-sm opacity-75">Acesse instantaneamente de qualquer lugar</p>
            </div>
            <div class="flex gap-2">
                <button onclick="installPWA()" class="btn">Instalar</button>
                <button onclick="dismissInstall()" class="text-sm opacity-75">N√£o</button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-6xl font-bold orbitron mb-4" style="background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                ALSHAM QUANTUM
            </h1>
            <p class="text-lg md:text-xl text-secondary mb-2">‚ö° QUANTUM-POWERED NEURAL PLATFORM</p>
            <p class="text-sm md:text-lg opacity-80">Advanced Enterprise Intelligence ‚Ä¢ Global Commerce Innovation</p>
            <div class="mt-4 text-sm opacity-60">
                <span id="version-info">Enterprise Edition v2.0</span> | 
                <span id="build-date">Build: 21/12/2024</span> |
                <span class="font-semibold" style="color: var(--accent-primary);">ALSHAM GLOBAL COMMERCE</span>
            </div>
        </header>

        <!-- Quantum Counter -->
        <div class="glass-card quantum-counter mb-8" role="region" aria-label="Contador Principal">
            <div class="quantum-counter-number orbitron" id="quantum-counter" aria-live="polite">0</div>
            <div class="text-xl md:text-2xl font-semibold mb-2" style="color: var(--accent-primary);">NEURAL CYCLES PROCESSED</div>
            <div class="text-base md:text-lg mb-2" id="uptime-display">System Uptime: 0d 0h 0m</div>
            <div class="text-sm opacity-75">
                <span id="cycles-per-second">0.000</span> cycles/sec | 
                <span id="performance-indicator">Performance: 0%</span> |
                <span id="efficiency-indicator">Efficiency: 0%</span>
            </div>
        </div>

        <!-- System Metrics Grid -->
        <div class="metrics-grid">
            <div class="glass-card card-3d p-4 md:p-6" role="region" aria-label="Enterprise Status">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-base md:text-lg font-semibold">üè¢ ENTERPRISE STATUS</h3>
                    <div class="w-4 h-4 bg-green-400 rounded-full animate-pulse" aria-label="Sistema Online"></div>
                </div>
                <div class="text-2xl md:text-3xl font-bold orbitron" id="overall-performance" aria-live="polite">0%</div>
                <div class="text-xs md:text-sm opacity-75">Quantum Performance Index</div>
            </div>

            <div class="glass-card card-3d p-4 md:p-6" role="region" aria-label="Neural Agents">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-base md:text-lg font-semibold">ü§ñ NEURAL AGENTS</h3>
                    <i class="fas fa-microchip text-xl md:text-2xl" style="color: var(--accent-primary);" aria-hidden="true"></i>
                </div>
                <div class="text-2xl md:text-3xl font-bold orbitron" id="active-agents" aria-live="polite">3</div>
                <div class="text-xs md:text-sm opacity-75">Active / 3 Total</div>
            </div>

            <div class="glass-card card-3d p-4 md:p-6" role="region" aria-label="Enterprise Value">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-base md:text-lg font-semibold">üíé ENTERPRISE VALUE</h3>
                    <i class="fas fa-gem text-xl md:text-2xl" style="color: var(--accent-tertiary);" aria-hidden="true"></i>
                </div>
                <div class="text-lg md:text-2xl font-bold orbitron">R$ 1.430.000</div>
                <div class="text-xs md:text-sm opacity-75">Quantum Neural Platform</div>
            </div>

            <div class="glass-card card-3d p-4 md:p-6" role="region" aria-label="Business Intelligence">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-base md:text-lg font-semibold">üìä BUSINESS INSIGHTS</h3>
                    <i class="fas fa-chart-line text-xl md:text-2xl" style="color: var(--accent-secondary);" aria-hidden="true"></i>
                </div>
                <div class="text-sm md:text-lg font-semibold" id="business-insight" aria-live="polite">Analyzing market data...</div>
                <div class="text-xs md:text-sm opacity-75">Real-time Analytics</div>
            </div>
        </div>

        <!-- Agents Grid -->
        <div class="agent-grid">
            <!-- Core Agent -->
            <div class="glass-card card-3d p-4 md:p-6 cursor-pointer" onclick="openAgentModal('core')" role="button" aria-label="Abrir detalhes do Core Agent" tabindex="0">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex-1">
                        <h3 class="text-lg md:text-xl font-bold flex items-center mb-2">
                            <i class="fas fa-cogs mr-2 text-lg" style="color: #FF6B6B;" aria-hidden="true"></i>
                            Core Intelligence
                        </h3>
                        <p class="text-xs md:text-sm opacity-75">Neural Processing & Optimization</p>
                    </div>
                    <div class="progress-ring ml-4">
                        <svg width="100" height="100" aria-label="Performance do Core Agent">
                            <circle cx="50" cy="50" r="40" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="6"/>
                            <circle cx="50" cy="50" r="40" fill="none" stroke="#FF6B6B" stroke-width="6" 
                                    stroke-linecap="round" id="core-progress" stroke-dasharray="251" stroke-dashoffset="251"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-lg font-bold orbitron" id="core-performance" aria-live="polite">75%</span>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 text-xs md:text-sm">
                    <div>
                        <div class="opacity-75">Cycles:</div>
                        <div class="font-semibold" id="core-cycles" aria-live="polite">0</div>
                    </div>
                    <div>
                        <div class="opacity-75">Algorithm:</div>
                        <div class="font-semibold" id="core-technique" aria-live="polite">Quantum ML</div>
                    </div>
                </div>
            </div>

            <!-- Learn Agent -->
            <div class="glass-card card-3d p-4 md:p-6 cursor-pointer" onclick="openAgentModal('learn')" role="button" aria-label="Abrir detalhes do Learn Agent" tabindex="0">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex-1">
                        <h3 class="text-lg md:text-xl font-bold flex items-center mb-2">
                            <i class="fas fa-brain mr-2 text-lg" style="color: #9333EA;" aria-hidden="true"></i>
                            Learning Engine
                        </h3>
                        <p class="text-xs md:text-sm opacity-75">Adaptive Neural Networks</p>
                    </div>
                    <div class="progress-ring ml-4">
                        <svg width="100" height="100" aria-label="Performance do Learn Agent">
                            <circle cx="50" cy="50" r="40" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="6"/>
                            <circle cx="50" cy="50" r="40" fill="none" stroke="#9333EA" stroke-width="6" 
                                    stroke-linecap="round" id="learn-progress" stroke-dasharray="251" stroke-dashoffset="251"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-lg font-bold orbitron" id="learn-performance" aria-live="polite">83%</span>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 text-xs md:text-sm">
                    <div>
                        <div class="opacity-75">Accuracy:</div>
                        <div class="font-semibold" id="learn-accuracy" aria-live="polite">94.7%</div>
                    </div>
                    <div>
                        <div class="opacity-75">Model:</div>
                        <div class="font-semibold" id="learn-model" aria-live="polite">Quantum Neural</div>
                    </div>
                </div>
            </div>

            <!-- Guard Agent -->
            <div class="glass-card card-3d p-4 md:p-6 cursor-pointer" onclick="openAgentModal('guard')" role="button" aria-label="Abrir detalhes do Guard Agent" tabindex="0">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex-1">
                        <h3 class="text-lg md:text-xl font-bold flex items-center mb-2">
                            <i class="fas fa-shield-alt mr-2 text-lg" style="color: #00F5FF;" aria-hidden="true"></i>
                            Security Matrix
                        </h3>
                        <p class="text-xs md:text-sm opacity-75">Enterprise Protection & Monitoring</p>
                    </div>
                    <div class="progress-ring ml-4">
                        <svg width="100" height="100" aria-label="Uptime do Guard Agent">
                            <circle cx="50" cy="50" r="40" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="6"/>
                            <circle cx="50" cy="50" r="40" fill="none" stroke="#00F5FF" stroke-width="6" 
                                    stroke-linecap="round" id="guard-progress" stroke-dasharray="251" stroke-dashoffset="251"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-lg font-bold orbitron" id="guard-uptime" aria-live="polite">99.9%</span>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 text-xs md:text-sm">
                    <div>
                        <div class="opacity-75">Status:</div>
                        <div class="font-semibold" id="guard-status" aria-live="polite">SECURE</div>
                    </div>
                    <div>
                        <div class="opacity-75">Protocol:</div>
                        <div class="font-semibold" id="guard-protocol" aria-live="polite">Quantum Shield</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 mb-8">
            <!-- Timeline Chart -->
            <div class="glass-card p-4 md:p-6" role="region" aria-label="Gr√°fico de Performance">
                <h3 class="text-lg md:text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-chart-area mr-2" style="color: var(--accent-primary);" aria-hidden="true"></i>
                    Neural Performance Timeline
                </h3>
                <div class="chart-container">
                    <canvas id="timelineChart" aria-label="Gr√°fico de performance ao longo do tempo"></canvas>
                </div>
            </div>

            <!-- Live Event Log -->
            <div class="glass-card p-4 md:p-6" role="region" aria-label="Log de Eventos em Tempo Real">
                <h3 class="text-lg md:text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-stream mr-2" style="color: var(--accent-secondary);" aria-hidden="true"></i>
                    Enterprise Event Stream
                    <span class="ml-2 px-2 py-1 text-xs rounded-full bg-red-500 animate-pulse">LIVE</span>
                </h3>
                <div class="event-log" id="event-log" role="log" aria-live="polite">
                    <div class="text-center opacity-75 py-8">
                        <i class="fas fa-satellite-dish text-2xl md:text-3xl mb-2" aria-hidden="true"></i>
                        <p>Connecting to neural network...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Health Section -->
        <div class="glass-card p-4 md:p-6 mb-8" role="region" aria-label="Sa√∫de do Sistema">
            <h3 class="text-lg md:text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-heartbeat mr-2" style="color: var(--accent-primary);" aria-hidden="true"></i>
                Enterprise System Health
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-center p-4 glass-card">
                    <div class="text-2xl mb-2">üíæ</div>
                    <div class="font-semibold">Memory</div>
                    <div class="text-lg font-bold orbitron" id="memory-usage" aria-live="polite">64%</div>
                </div>
                <div class="text-center p-4 glass-card">
                    <div class="text-2xl mb-2">‚ö°</div>
                    <div class="font-semibold">Processing</div>
                    <div class="text-lg font-bold orbitron" id="cpu-usage" aria-live="polite">42%</div>
                </div>
                <div class="text-center p-4 glass-card">
                    <div class="text-2xl mb-2">üåê</div>
                    <div class="font-semibold">Network</div>
                    <div class="text-lg font-bold orbitron" id="network-status" aria-live="polite">OPTIMAL</div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-12 mb-8">
            <div class="glass-card p-4 md:p-6">
                <p class="text-base md:text-lg font-semibold mb-2">üè¢ ENTERPRISE EXCELLENCE</p>
                <p class="text-lg md:text-xl italic" style="color: var(--accent-primary);">"Transforming Commerce Through Quantum Intelligence"</p>
                <p class="text-xs md:text-sm opacity-75 mt-4">ALSHAM QUANTUM - Advanced Neural Platform for Global Commerce Leadership</p>
                <div class="mt-4 text-xs opacity-50">
                    <p>Enterprise PWA Edition | Quantum-Optimized Performance | Powered by ALSHAM GLOBAL COMMERCE</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <div id="agent-modal" class="modal" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl md:text-2xl font-bold orbitron" id="modal-title">Neural Agent Details</h2>
                <button onclick="closeModal()" class="text-2xl hover:text-red-400 transition-colors" aria-label="Fechar modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modal-body">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Micro Update Popup -->
    <div id="micro-update" class="micro-update" role="alert" aria-live="assertive">
        <i class="fas fa-plus mr-2"></i>
        Neural cycle completed!
    </div>

    <!-- PWA Manifest (Inline) -->
    <script id="pwa-manifest" type="application/json">
    {
        "name": "ALSHAM QUANTUM - Enterprise Neural Platform",
        "short_name": "ALSHAM QUANTUM",
        "description": "Advanced Quantum-Powered Neural Platform for Enterprise Commerce Intelligence",
        "start_url": "./",
        "display": "standalone",
        "background_color": "#1a1a2e",
        "theme_color": "#F4D03F",
        "orientation": "portrait-primary",
        "scope": "./",
        "lang": "pt-BR",
        "categories": ["business", "productivity", "utilities", "finance"],
        "icons": [
            {
                "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23F4D03F;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%236C3483;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='192' height='192' fill='url(%23grad)' rx='20'/%3E%3Ctext x='96' y='110' font-family='Orbitron' font-size='28' font-weight='bold' text-anchor='middle' fill='white'%3EQUANTUM%3C/text%3E%3Ccircle cx='96' cy='60' r='20' fill='white' opacity='0.8'/%3E%3C/svg%3E",
                "sizes": "192x192",
                "type": "image/svg+xml",
                "purpose": "any"
            },
            {
                "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23F4D03F;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%236C3483;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' fill='url(%23grad)' rx='50'/%3E%3Ctext x='256' y='320' font-family='Orbitron' font-size='72' font-weight='bold' text-anchor='middle' fill='white'%3EQUANTUM%3C/text%3E%3Ccircle cx='256' cy='180' r='60' fill='white' opacity='0.8'/%3E%3C/svg%3E",
                "sizes": "512x512",
                "type": "image/svg+xml",
                "purpose": "any maskable"
            }
        ],
        "shortcuts": [
            {
                "name": "Neural Dashboard",
                "url": "./?shortcut=dashboard",
                "description": "Access main neural dashboard",
                "icons": [{"src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23F4D03F'%3E%3Cpath d='M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z'/%3E%3C/svg%3E", "sizes": "96x96", "type": "image/svg+xml"}]
            },
            {
                "name": "Agent Metrics",
                "url": "./?shortcut=agents",
                "description": "View neural agent performance",
                "icons": [{"src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%239333EA'%3E%3Cpath d='M20,4C21.11,4 22,4.89 22,6V18C22,19.11 21.11,20 20,20H4C2.89,20 2,19.11 2,18V6C2,4.89 2.89,4 4,4H20M20,18V6H4V18H20Z'/%3E%3C/svg%3E", "sizes": "96x96", "type": "image/svg+xml"}]
            }
        ]
    }
    </script>

    <script>
        // ===== PWA SERVICE WORKER REGISTRATION =====
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const swCode = `
                        const CACHE_NAME = 'alsham-quantum-v2.0.0';
                        const CACHE_URLS = [
                            './',
                            'https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css',
                            'https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css',
                            'https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap',
                            'https://cdn.jsdelivr.net/npm/chart.js',
                            'https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js',
                            'https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js',
                            'https://cdn.jsdelivr.net/npm/countup.js@2.6.2/dist/countUp.umd.js'
                        ];

                        self.addEventListener('install', (event) => {
                            event.waitUntil(
                                caches.open(CACHE_NAME)
                                    .then((cache) => cache.addAll(CACHE_URLS))
                                    .then(() => self.skipWaiting())
                            );
                        });

                        self.addEventListener('activate', (event) => {
                            event.waitUntil(
                                caches.keys().then((cacheNames) => {
                                    return Promise.all(
                                        cacheNames.map((cacheName) => {
                                            if (cacheName !== CACHE_NAME) {
                                                return caches.delete(cacheName);
                                            }
                                        })
                                    );
                                }).then(() => self.clients.claim())
                            );
                        });

                        self.addEventListener('fetch', (event) => {
                            if (event.request.url.includes('/ws')) return;
                            
                            event.respondWith(
                                fetch(event.request)
                                    .then((response) => {
                                        if (response && response.status === 200) {
                                            const responseToCache = response.clone();
                                            caches.open(CACHE_NAME)
                                                .then((cache) => cache.put(event.request, responseToCache));
                                        }
                                        return response;
                                    })
                                    .catch(() => caches.match(event.request))
                            );
                        });

                        self.addEventListener('push', (event) => {
                            const options = {
                                body: event.data ? event.data.text() : 'Nova atualiza√ß√£o no ALSHAM QUANTUM',
                                icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 192"><defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#F4D03F;stop-opacity:1" /><stop offset="100%" style="stop-color:#6C3483;stop-opacity:1" /></linearGradient></defs><rect width="192" height="192" fill="url(#grad)" rx="20"/><text x="96" y="110" font-family="Orbitron" font-size="28" font-weight="bold" text-anchor="middle" fill="white">QUANTUM</text><circle cx="96" cy="60" r="20" fill="white" opacity="0.8"/></svg>',
                                badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72"><circle cx="36" cy="36" r="36" fill="#F4D03F"/><text x="36" y="45" font-family="Orbitron" font-size="18" font-weight="bold" text-anchor="middle" fill="white">Q</text></svg>',
                                vibrate: [200, 100, 200],
                                tag: 'quantum-notification',
                                requireInteraction: true
                            };

                            event.waitUntil(
                                self.registration.showNotification('ALSHAM QUANTUM', options)
                            );
                        });
                    `;

                    const swBlob = new Blob([swCode], { type: 'application/javascript' });
                    const swUrl = URL.createObjectURL(swBlob);
                    const registration = await navigator.serviceWorker.register(swUrl);
                    
                    console.log('üéØ ALSHAM QUANTUM Service Worker registrado:', registration.scope);
                    
                    if ('Notification' in window && Notification.permission === 'default') {
                        await Notification.requestPermission();
                    }
                    
                } catch (error) {
                    console.error('‚ùå Erro ao registrar Service Worker:', error);
                }
            });
        }

        // ===== WEB APP MANIFEST INJECTION =====
        window.addEventListener('DOMContentLoaded', () => {
            const manifestJson = document.getElementById('pwa-manifest').textContent;
            const manifestBlob = new Blob([manifestJson], { type: 'application/json' });
            const manifestUrl = URL.createObjectURL(manifestBlob);
            
            const manifestLink = document.createElement('link');
            manifestLink.rel = 'manifest';
            manifestLink.href = manifestUrl;
            document.head.appendChild(manifestLink);
        });

        // ===== PWA INSTALL PROMPT =====
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-prompt').classList.add('show');
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('üéâ ALSHAM QUANTUM PWA instalado!');
                    }
                    deferredPrompt = null;
                    dismissInstall();
                });
            }
        }

        function dismissInstall() {
            document.getElementById('install-prompt').classList.remove('show');
        }

        // ===== SOUND DESIGN PREMIUM =====
        class QuantumSoundDesign {
            constructor() {
                this.audioContext = null;
                this.sounds = {};
                this.enabled = true;
                this.init();
            }

            async init() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.createSounds();
                } catch (e) {
                    console.log('Web Audio API not supported');
                    this.enabled = false;
                }
            }

            createSounds() {
                this.sounds = {
                    cycle: () => this.playQuantumTone(440, 0.1, 'sine'),
                    hover: () => this.playQuantumTone(220, 0.05, 'triangle'),
                    click: () => this.playQuantumTone(880, 0.08, 'square'),
                    notification: () => this.playQuantumTone(660, 0.15, 'sawtooth'),
                    success: () => this.playQuantumChord([440, 554, 659], 0.2),
                    error: () => this.playQuantumTone(200, 0.3, 'sawtooth')
                };
            }

            async playQuantumTone(frequency, duration, type = 'sine') {
                if (!this.enabled || !this.audioContext) return;

                if (this.audioContext.state === 'suspended') {
                    await this.audioContext.resume();
                }
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.03, this.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }

            async playQuantumChord(frequencies, duration) {
                frequencies.forEach(freq => this.playQuantumTone(freq, duration));
            }

            play(soundName) {
                if (this.sounds[soundName] && this.enabled) {
                    this.sounds[soundName]();
                }
            }
        }

        // ===== QUANTUM PARTICLES SYSTEM =====
        class QuantumParticlesSystem {
            constructor() {
                this.scene = new THREE.Scene();
                this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                this.renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                this.particles = [];
                this.mouse = { x: 0, y: 0 };
                this.init();
            }

            init() {
                const container = document.getElementById('particles-container');
                if (!container) return;

                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.setClearColor(0x000000, 0);
                container.appendChild(this.renderer.domElement);

                this.camera.position.z = 5;
                this.createQuantumParticles();
                this.animate();
                this.bindEvents();
            }

            createQuantumParticles() {
                const geometry = new THREE.SphereGeometry(0.012, 8, 8);
                
                for (let i = 0; i < 120; i++) {
                    const material = new THREE.MeshBasicMaterial({ 
                        color: this.getCurrentThemeColor(),
                        transparent: true,
                        opacity: 0.7
                    });

                    const particle = new THREE.Mesh(geometry, material);
                    particle.position.set(
                        (Math.random() - 0.5) * 18,
                        (Math.random() - 0.5) * 18,
                        (Math.random() - 0.5) * 18
                    );
                    
                    particle.userData = {
                        velocity: new THREE.Vector3(
                            (Math.random() - 0.5) * 0.008,
                            (Math.random() - 0.5) * 0.008,
                            (Math.random() - 0.5) * 0.008
                        ),
                        originalPosition: particle.position.clone(),
                        oscillation: Math.random() * Math.PI * 2,
                        quantumFreq: Math.random() * 0.02 + 0.01
                    };
                    
                    this.scene.add(particle);
                    this.particles.push(particle);
                }
            }

            getCurrentThemeColor() {
                const style = getComputedStyle(document.body);
                const color = style.getPropertyValue('--particles-color').trim() || '#F4D03F';
                return color;
            }

            animate() {
                requestAnimationFrame(() => this.animate());

                const time = Date.now() * 0.001;

                this.particles.forEach((particle, index) => {
                    // Quantum oscillation
                    particle.userData.oscillation += particle.userData.quantumFreq;
                    particle.position.y += Math.sin(particle.userData.oscillation) * 0.0008;
                    particle.position.x += Math.cos(particle.userData.oscillation * 1.3) * 0.0006;
                    
                    // Base movement
                    particle.position.add(particle.userData.velocity);

                    // Mouse quantum entanglement
                    if (this.mouse.x !== 0 && this.mouse.y !== 0) {
                        const mouseInfluence = 0.0001;
                        const distance = particle.position.distanceTo(new THREE.Vector3(this.mouse.x * 3, -this.mouse.y * 3, 0));
                        if (distance < 3) {
                            particle.position.x += this.mouse.x * mouseInfluence * (3 - distance);
                            particle.position.y += -this.mouse.y * mouseInfluence * (3 - distance);
                        }
                    }

                    // Quantum field reset
                    if (particle.position.distanceTo(particle.userData.originalPosition) > 10) {
                        particle.position.copy(particle.userData.originalPosition);
                        particle.position.add(new THREE.Vector3(
                            (Math.random() - 0.5) * 4,
                            (Math.random() - 0.5) * 4,
                            (Math.random() - 0.5) * 4
                        ));
                    }

                    // Quantum rotation
                    particle.rotation.x += 0.003;
                    particle.rotation.y += 0.003;
                    particle.rotation.z += 0.001;
                });

                this.renderer.render(this.scene, this.camera);
            }

            bindEvents() {
                window.addEventListener('mousemove', (event) => {
                    this.mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                    this.mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
                });

                window.addEventListener('resize', () => {
                    this.camera.aspect = window.innerWidth / window.innerHeight;
                    this.camera.updateProjectionMatrix();
                    this.renderer.setSize(window.innerWidth, window.innerHeight);
                });
            }

            updateTheme() {
                const newColor = this.getCurrentThemeColor();
                this.particles.forEach(particle => {
                    particle.material.color.setStyle(newColor);
                });
            }

            destroy() {
                if (this.renderer && this.renderer.domElement) {
                    this.renderer.domElement.remove();
                }
            }
        }

        // ===== BUSINESS INSIGHTS SYSTEM =====
        class BusinessInsights {
            constructor() {
                this.insights = [
                    "üìä Revenue optimization algorithms detected 15% growth opportunity",
                    "‚ö° Market analysis shows premium segment expansion potential",
                    "üéØ Customer behavior patterns indicate new product demand",
                    "üí° Predictive models suggest Q1 performance will exceed targets",
                    "üöÄ AI-driven cost reduction initiatives showing 8% efficiency gain",
                    "üìà Global commerce metrics indicate strong market position",
                    "üîÆ Neural networks predict favorable market conditions ahead",
                    "üíé Enterprise optimization protocols yielding superior results",
                    "‚öôÔ∏è Quantum processing delivering unprecedented analytical depth",
                    "üè¢ Strategic AI recommendations validated with 97% accuracy"
                ];
                this.currentIndex = 0;
                this.startRotation();
            }

            startRotation() {
                setInterval(() => {
                    this.updateInsight();
                }, 7000);
            }

            updateInsight() {
                const element = document.getElementById('business-insight');
                if (element) {
                    element.style.opacity = '0';
                    setTimeout(() => {
                        element.textContent = this.insights[this.currentIndex];
                        element.style.opacity = '1';
                        this.currentIndex = (this.currentIndex + 1) % this.insights.length;
                    }, 200);
                }
            }
        }

        // ===== QUANTUM WEBSOCKET MANAGER =====
        class QuantumWebSocketManager {
            constructor() {
                this.ws = null;
                this.reconnectAttempts = 0;
                this.maxReconnectAttempts = 5;
                this.reconnectDelay = 3000;
                this.heartbeatInterval = null;
                this.lastHeartbeat = Date.now();
                this.isSimulating = false;
                this.simulationInterval = null;
                this.lastData = null;
                this.connect();
            }

            connect() {
                this.updateConnectionStatus(false, 'Connecting to neural network...');
                
                try {
                    const wsUrl = 'wss://suna-alsham-automl-production.up.railway.app/ws';
                    console.log('üîó Connecting ALSHAM QUANTUM to:', wsUrl);

                    this.ws = new WebSocket(wsUrl);
                    
                    this.ws.onopen = () => {
                        console.log('üîó ALSHAM QUANTUM connected to neural network!');
                        this.reconnectAttempts = 0;
                        this.updateConnectionStatus(true, 'Neural network active');
                        this.startHeartbeat();
                        this.stopSimulation();
                        if (window.quantumSoundDesign) window.quantumSoundDesign.play('success');
                    };

                    this.ws.onmessage = (event) => {
                        this.lastHeartbeat = Date.now();
                        try {
                            const data = JSON.parse(event.data);
                            this.handleMessage(data);
                        } catch (error) {
                            console.error('Neural data processing error:', error);
                        }
                    };

                    this.ws.onclose = (event) => {
                        console.log('üîó Neural network disconnected:', event.code);
                        this.updateConnectionStatus(false, 'Neural network offline');
                        this.stopHeartbeat();
                        this.attemptReconnect();
                    };

                    this.ws.onerror = (error) => {
                        console.error('‚ùå Neural network error:', error);
                        this.updateConnectionStatus(false, 'Connection error');
                        if (window.quantumSoundDesign) window.quantumSoundDesign.play('error');
                    };

                    setTimeout(() => {
                        if (this.ws && this.ws.readyState === WebSocket.CONNECTING) {
                            this.ws.close();
                            this.startHttpFallback();
                        }
                    }, 10000);

                } catch (error) {
                    console.error('‚ùå Neural connection error:', error);
                    this.startHttpFallback();
                }
            }

            async startHttpFallback() {
                console.log('üîÑ Initializing HTTP neural bridge...');
                this.updateConnectionStatus(false, 'HTTP neural bridge active');
                
                try {
                    const response = await fetch('https://suna-alsham-automl-production.up.railway.app/api/metrics');
                    if (response.ok) {
                        const data = await response.json();
                        this.updateDashboard(data);
                        console.log('üì° Neural data loaded via HTTP bridge');
                        
                        setInterval(async () => {
                            try {
                                const response = await fetch('https://suna-alsham-automl-production.up.railway.app/api/metrics');
                                if (response.ok) {
                                    const data = await response.json();
                                    this.updateDashboard(data);
                                }
                            } catch (error) {
                                console.log('HTTP bridge error, activating simulation mode');
                                this.startSimulation();
                            }
                        }, 5000);
                        
                    } else {
                        throw new Error('HTTP bridge response not ok');
                    }
                } catch (error) {
                    console.log('HTTP bridge failed, starting simulation mode');
                    this.startSimulation();
                }
            }

            startHeartbeat() {
                this.heartbeatInterval = setInterval(() => {
                    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                        this.ws.send(JSON.stringify({ type: 'quantum_ping' }));
                    }
                    
                    if (Date.now() - this.lastHeartbeat > 30000) {
                        console.log('üíî Neural heartbeat lost, reconnecting...');
                        this.ws.close();
                    }
                }, 15000);
            }

            stopHeartbeat() {
                if (this.heartbeatInterval) {
                    clearInterval(this.heartbeatInterval);
                    this.heartbeatInterval = null;
                }
            }

            handleMessage(data) {
                this.lastData = data.data || data;
                
                switch (data.type) {
                    case 'initial_data':
                    case 'metrics_update':
                        this.updateDashboard(data.data);
                        break;
                    case 'cycle_completed':
                        this.handleQuantumCycleEvent(data);
                        break;
                    case 'quantum_pong':
                        this.lastHeartbeat = Date.now();
                        break;
                    case 'notification':
                        this.showQuantumNotification(data);
                        break;
                    default:
                        console.log('Unknown neural signal:', data.type);
                }
            }

            updateDashboard(data) {
                try {
                    // Update quantum counter with animation
                    if (data.cycle_counter) {
                        this.animateQuantumCounter('quantum-counter', data.cycle_counter.total_cycles);
                        
                        const uptime = data.cycle_counter.uptime;
                        const uptimeEl = document.getElementById('uptime-display');
                        if (uptimeEl && uptime) {
                            uptimeEl.textContent = `System Uptime: ${uptime.days || 0}d ${uptime.hours || 0}h ${uptime.minutes || 0}m`;
                        }
                        
                        const cpsEl = document.getElementById('cycles-per-second');
                        if (cpsEl) {
                            cpsEl.textContent = (data.cycle_counter.cycles_per_second || 0).toFixed(3);
                        }
                    }

                    // Update neural agents
                    if (data.agents) {
                        this.updateNeuralAgent('core', data.agents.core);
                        this.updateNeuralAgent('learn', data.agents.learn);
                        this.updateNeuralAgent('guard', data.agents.guard);
                    }

                    // Update enterprise metrics
                    if (data.system) {
                        const perfEl = document.getElementById('overall-performance');
                        if (perfEl) {
                            perfEl.textContent = Math.round(data.system.performance || 85) + '%';
                        }
                        
                        const perfIndEl = document.getElementById('performance-indicator');
                        if (perfIndEl) {
                            perfIndEl.textContent = `Performance: ${Math.round(data.system.performance || 85)}%`;
                        }

                        this.updateSystemHealth(data.system);
                    }

                    // Update enterprise event stream
                    if (data.recent_events) {
                        this.updateEventStream(data.recent_events);
                    }

                    // Update neural timeline
                    if (data.timeline_data && window.neuralTimelineChart) {
                        this.updateNeuralChart(data.timeline_data);
                    }

                } catch (error) {
                    console.error('Dashboard update error:', error);
                }
            }

            updateNeuralAgent(agentName, agentData) {
                try {
                    if (!agentData) return;
                    
                    if (agentName === 'core') {
                        const perfEl = document.getElementById('core-performance');
                        if (perfEl) perfEl.textContent = Math.round((agentData.performance || 0.75) * 100) + '%';
                        
                        const cyclesEl = document.getElementById('core-cycles');
                        if (cyclesEl) cyclesEl.textContent = agentData.automl_cycles || 0;
                        
                        const techEl = document.getElementById('core-technique');
                        if (techEl) techEl.textContent = agentData.last_technique || 'Quantum ML';
                        
                        this.updateProgressRing('core-progress', agentData.performance || 0.75);
                        
                    } else if (agentName === 'learn') {
                        const perfEl = document.getElementById('learn-performance');
                        if (perfEl) perfEl.textContent = Math.round((agentData.performance || 0.83) * 100) + '%';
                        
                        const accEl = document.getElementById('learn-accuracy');
                        if (accEl) accEl.textContent = (agentData.accuracy || 94.7).toFixed(1) + '%';
                        
                        const modelEl = document.getElementById('learn-model');
                        if (modelEl) modelEl.textContent = agentData.last_model || 'Quantum Neural';
                        
                        this.updateProgressRing('learn-progress', agentData.performance || 0.83);
                        
                    } else if (agentName === 'guard') {
                        const uptimeEl = document.getElementById('guard-uptime');
                        if (uptimeEl) uptimeEl.textContent = (agentData.uptime || 99.9).toFixed(1) + '%';
                        
                        const statusEl = document.getElementById('guard-status');
                        if (statusEl) statusEl.textContent = agentData.status || 'SECURE';
                        
                        const protocolEl = document.getElementById('guard-protocol');
                        if (protocolEl) protocolEl.textContent = agentData.last_protocol || 'Quantum Shield';
                        
                        this.updateProgressRing('guard-progress', (agentData.uptime || 99.9) / 100);
                    }
                } catch (error) {
                    console.error(`Error updating neural agent ${agentName}:`, error);
                }
            }

            updateSystemHealth(systemData) {
                const memoryEl = document.getElementById('memory-usage');
                if (memoryEl) memoryEl.textContent = Math.round(systemData.memory_usage || 64) + '%';
                
                const cpuEl = document.getElementById('cpu-usage');
                if (cpuEl) cpuEl.textContent = Math.round(systemData.cpu_usage || 42) + '%';
                
                const networkEl = document.getElementById('network-status');
                if (networkEl) networkEl.textContent = systemData.network_status || 'OPTIMAL';
            }

            handleQuantumCycleEvent(eventData) {
                this.showMicroUpdate(`${eventData.icon || '‚ö°'} ${eventData.message || 'Quantum cycle completed'}`);
                
                if (window.quantumSoundDesign) {
                    window.quantumSoundDesign.play('cycle');
                }

                this.addEventToStream(eventData);

                if ('serviceWorker' in navigator && 'PushManager' in window) {
                    this.sendQuantumPushNotification(eventData);
                }
            }

            updateEventStream(events) {
                const eventLog = document.getElementById('event-log');
                if (!eventLog) return;
                
                eventLog.innerHTML = '';
                
                events.slice(0, 8).forEach(event => {
                    const eventElement = document.createElement('div');
                    eventElement.className = 'event-item';
                    eventElement.innerHTML = `
                        <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3 flex-shrink-0" 
                             style="background: ${event.color || '#F4D03F'}20; color: ${event.color || '#F4D03F'};">
                            ${event.icon || '‚ö°'}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium truncate">${event.message || 'Neural network event'}</div>
                            <div class="text-xs opacity-75">${event.timestamp || new Date().toLocaleTimeString()}</div>
                        </div>
                    `;
                    eventLog.appendChild(eventElement);
                });
            }

            addEventToStream(event) {
                const eventLog = document.getElementById('event-log');
                if (!eventLog) return;

                const eventElement = document.createElement('div');
                eventElement.className = 'event-item';
                eventElement.style.opacity = '0';
                eventElement.innerHTML = `
                    <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3 flex-shrink-0" 
                         style="background: ${event.color || '#F4D03F'}20; color: ${event.color || '#F4D03F'};">
                        ${event.icon || '‚ö°'}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="font-medium truncate">${event.message || 'Neural network event'}</div>
                        <div class="text-xs opacity-75">${event.timestamp || new Date().toLocaleTimeString()}</div>
                    </div>
                `;
                
                eventLog.insertBefore(eventElement, eventLog.firstChild);
                
                setTimeout(() => {
                    eventElement.style.opacity = '1';
                    eventElement.style.transform = 'translateX(0)';
                }, 100);
                
                while (eventLog.children.length > 8) {
                    eventLog.removeChild(eventLog.lastChild);
                }
            }

            showMicroUpdate(message) {
                const popup = document.getElementById('micro-update');
                if (popup) {
                    popup.innerHTML = `<i class="fas fa-atom mr-2"></i>${message}`;
                    popup.classList.add('show');
                    
                    setTimeout(() => {
                        popup.classList.remove('show');
                    }, 3000);
                }
            }

            animateQuantumCounter(elementId, targetValue) {
                const element = document.getElementById(elementId);
                if (!element) return;

                const currentValue = parseInt(element.textContent.replace(/,/g, '')) || 0;
                
                if (targetValue > currentValue) {
                    if (typeof countUp !== 'undefined' && countUp.CountUp) {
                        const countUpInstance = new countUp.CountUp(elementId, targetValue, {
                            startVal: currentValue,
                            duration: 2,
                            separator: ',',
                            decimal: '.',
                            useEasing: true,
                            useGrouping: true
                        });
                        countUpInstance.start();
                    } else {
                        element.textContent = targetValue.toLocaleString();
                    }
                }
            }

            updateProgressRing(elementId, percentage) {
                const circle = document.getElementById(elementId);
                if (circle) {
                    const circumference = 2 * Math.PI * 40; // r=40
                    const offset = circumference - (Math.min(Math.max(percentage, 0), 1) * circumference);
                    circle.style.strokeDashoffset = offset;
                }
            }

            updateConnectionStatus(connected, message = '') {
                const dot = document.getElementById('connection-dot');
                const text = document.getElementById('connection-text');
                
                if (dot) {
                    dot.classList.toggle('connected', connected);
                }
                
                if (text) {
                    text.textContent = message || (connected ? 'Neural network active' : 'Neural network offline');
                }
            }

            attemptReconnect() {
                if (this.reconnectAttempts < this.maxReconnectAttempts) {
                    this.reconnectAttempts++;
                    this.updateConnectionStatus(false, `Reconnecting to neural network... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);
                    console.log(`üîÑ Neural reconnection attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts}`);
                    
                    setTimeout(() => this.connect(), this.reconnectDelay * this.reconnectAttempts);
                } else {
                    console.log('üö´ Maximum neural reconnection attempts reached. Starting simulation mode.');
                    this.updateConnectionStatus(false, 'Offline - Simulation active');
                    this.startSimulation();
                }
            }

            startSimulation() {
                if (this.isSimulating) return;
                
                this.isSimulating = true;
                console.log('üé≠ Starting ALSHAM QUANTUM simulation mode...');
                
                let cycles = 200;
                let corePerf = 0.78;
                let learnPerf = 0.85;
                let guardUptime = 99.9;
                
                this.updateDashboard({
                    cycle_counter: {
                        total_cycles: cycles,
                        uptime: { days: 3, hours: 12, minutes: 45 },
                        cycles_per_second: 0.145
                    },
                    agents: {
                        core: { performance: corePerf, automl_cycles: cycles, last_technique: 'Quantum ML' },
                        learn: { performance: learnPerf, accuracy: 96.2, last_model: 'Quantum Neural' },
                        guard: { uptime: guardUptime, status: 'SECURE', last_protocol: 'Quantum Shield' }
                    },
                    system: {
                        performance: (corePerf + learnPerf) * 50,
                        memory_usage: 68,
                        cpu_usage: 45,
                        network_status: 'SIMULATED'
                    },
                    recent_events: [
                        { icon: '‚ö°', message: 'ALSHAM QUANTUM simulation mode activated', color: '#F4D03F', timestamp: new Date().toLocaleTimeString() }
                    ]
                });

                this.simulationInterval = setInterval(() => {
                    cycles += Math.floor(Math.random() * 4) + 1;
                    corePerf = Math.min(0.96, corePerf + (Math.random() - 0.5) * 0.02);
                    learnPerf = Math.min(0.98, learnPerf + (Math.random() - 0.5) * 0.015);
                    guardUptime = Math.max(99.0, Math.min(100, guardUptime + (Math.random() - 0.5) * 0.1));
                    
                    this.updateDashboard({
                        cycle_counter: {
                            total_cycles: cycles,
                            uptime: { days: 3, hours: 12, minutes: Math.floor(Date.now() / 60000) % 60 },
                            cycles_per_second: 0.12 + Math.random() * 0.08
                        },
                        agents: {
                            core: { performance: corePerf, automl_cycles: cycles, last_technique: 'Quantum ML' },
                            learn: { performance: learnPerf, accuracy: 95 + Math.random() * 3, last_model: 'Quantum Neural' },
                            guard: { uptime: guardUptime, status: 'SECURE', last_protocol: 'Quantum Shield' }
                        },
                        system: {
                            performance: (corePerf + learnPerf) * 50,
                            memory_usage: 65 + Math.random() * 15,
                            cpu_usage: 40 + Math.random() * 20,
                            network_status: 'SIMULATED'
                        }
                    });

                    if (Math.random() < 0.4) {
                        const events = [
                            { icon: '‚ö°', message: `Quantum Cycle #${cycles} processed successfully`, color: '#F4D03F' },
                            { icon: 'üß†', message: 'Learning Engine: Neural optimization completed', color: '#9333EA' },
                            { icon: 'üîß', message: 'Core Intelligence: Performance enhancement applied', color: '#FF6B6B' },
                            { icon: 'üõ°Ô∏è', message: 'Security Matrix: Enterprise protection verified', color: '#00F5FF' },
                            { icon: 'üìä', message: 'Business Intelligence: Market analysis updated', color: '#2ECC71' }
                        ];
                        
                        const randomEvent = events[Math.floor(Math.random() * events.length)];
                        randomEvent.timestamp = new Date().toLocaleTimeString();
                        this.addEventToStream(randomEvent);
                    }
                }, 3500 + Math.random() * 2000);
            }

            stopSimulation() {
                if (this.simulationInterval) {
                    clearInterval(this.simulationInterval);
                    this.simulationInterval = null;
                    this.isSimulating = false;
                    console.log('üé≠ Simulation mode deactivated');
                }
            }

            // ===== REAL DATA INTEGRATION FOR MODALS =====
            async fetchAgentDetails(agentName) {
                try {
                    const response = await fetch(`/api/agent/${agentName}/details`);
                    if (response.ok) {
                        const realData = await response.json();
                        return this.generateRealMetrics(agentName, realData);
                    } else {
                        throw new Error('API not available');
                    }
                } catch (error) {
                    console.log('Using fallback data for agent modal');
                    return this.getFallbackData(agentName);
                }
            }

            generateRealMetrics(agentName, apiData) {
                if (agentName === 'core') {
                    return {
                        'Current Performance': `${(apiData.basic_metrics?.performance * 100).toFixed(2)}%`,
                        'Cycles Executed': apiData.basic_metrics?.automl_cycles || '0',
                        'Trials Completed': apiData.total_training_samples || '0',
                        'Processing Time': `${apiData.avg_processing_time?.toFixed(1)}s` || '0.0s',
                        'Memory Usage': `${apiData.system_resources?.avg_memory?.toFixed(1)}%` || '0%',
                        'CPU Usage': `${apiData.system_resources?.avg_cpu?.toFixed(1)}%` || '0%',
                        'Success Rate': `${((apiData.basic_metrics?.improvement || 0) * 100).toFixed(1)}%`
                    };
                } else if (agentName === 'learn') {
                    return {
                        'Performance': `${(apiData.basic_metrics?.performance * 100).toFixed(2)}%`,
                        'Accuracy': `${apiData.basic_metrics?.accuracy?.toFixed(1)}%` || '94.7%',
                        'Training Cycles': apiData.basic_metrics?.training_cycles || '0',
                        'Samples Processed': apiData.total_training_samples || '0',
                        'Epochs Completed': apiData.avg_epochs?.toFixed(0) || '0',
                        'Model Type': apiData.basic_metrics?.last_model || 'Quantum Neural',
                        'Convergence Time': `${(apiData.avg_processing_time || 0).toFixed(1)}s`
                    };
                } else if (agentName === 'guard') {
                    return {
                        'System Uptime': `${(apiData.basic_metrics?.uptime || 99.9).toFixed(2)}%`,
                        'Security Status': apiData.basic_metrics?.status || 'SECURE',
                        'Checks Performed': apiData.basic_metrics?.checks || '0',
                        'Threats Detected': apiData.total_threats_scanned || '0',
                        'Response Time': `${(apiData.avg_response_time || 0.1).toFixed(2)}s`,
                        'Security Score': `${(apiData.avg_security_score || 98).toFixed(1)}%`,
                        'Protocol': apiData.basic_metrics?.last_protocol || 'Quantum Shield'
                    };
                }
                return {};
            }

            getFallbackData(agentName) {
                // Use data from WebSocket if available
                if (this.lastData?.agents?.[agentName]) {
                    return this.generateRealMetrics(agentName, {
                        basic_metrics: this.lastData.agents[agentName]
                    });
                }

                // Last resort: realistic simulated data
                const fallbackData = {
                    core: {
                        'Current Performance': '87.4%',
                        'Cycles Executed': '127',
                        'Trials Completed': '3,847',
                        'Processing Time': '2.1s',
                        'Memory Usage': '72.3%',
                        'CPU Usage': '58.7%',
                        'Success Rate': '91.2%'
                    },
                    learn: {
                        'Performance': '89.2%',
                        'Accuracy': '96.8%',
                        'Training Cycles': '94',
                        'Samples Processed': '247,392',
                        'Epochs Completed': '156',
                        'Model Type': 'Quantum Neural Network',
                        'Convergence Time': '3.4s'
                    },
                    guard: {
                        'System Uptime': '99.97%',
                        'Security Status': 'SECURE',
                        'Checks Performed': '8,924',
                        'Threats Detected': '0',
                        'Response Time': '0.08s',
                        'Security Score': '99.1%',
                        'Protocol': 'Quantum Shield Protocol'
                    }
                };

                return fallbackData[agentName] || {};
            }

            async sendQuantumPushNotification(eventData) {
                try {
                    if ('serviceWorker' in navigator) {
                        const registration = await navigator.serviceWorker.ready;
                        if (registration.pushManager) {
                            registration.showNotification('ALSHAM QUANTUM Alert', {
                                body: eventData.message,
                                icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 192"><defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#F4D03F;stop-opacity:1" /><stop offset="100%" style="stop-color:#6C3483;stop-opacity:1" /></linearGradient></defs><rect width="192" height="192" fill="url(#grad)" rx="20"/><text x="96" y="110" font-family="Orbitron" font-size="28" font-weight="bold" text-anchor="middle" fill="white">QUANTUM</text><circle cx="96" cy="60" r="20" fill="white" opacity="0.8"/></svg>',
                                tag: 'quantum-cycle',
                                requireInteraction: false,
                                vibrate: [200, 100, 200]
                            });
                        }
                    }
                } catch (error) {
                    console.log('Push notification not available:', error);
                }
            }

            destroy() {
                this.stopHeartbeat();
                this.stopSimulation();
                if (this.ws) {
                    this.ws.close();
                }
            }
        }

        // ===== QUANTUM THEME SYSTEM =====
        class QuantumThemeSystem {
            constructor() {
                this.currentTheme = 'quantum-glass';
                this.bindEvents();
                this.loadSavedTheme();
            }

            bindEvents() {
                document.querySelectorAll('.theme-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const theme = e.target.dataset.theme;
                        if (theme) {
                            this.switchTheme(theme);
                        }
                    });
                });
            }

            switchTheme(themeName) {
                document.querySelectorAll('.theme-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                const activeBtn = document.querySelector(`[data-theme="${themeName}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }

                document.body.className = `theme-${themeName}`;
                this.currentTheme = themeName;

                if (window.quantumParticlesSystem) {
                    window.quantumParticlesSystem.updateTheme();
                }

                localStorage.setItem('alsham-quantum-theme', themeName);

                if (window.quantumSoundDesign) {
                    window.quantumSoundDesign.play('click');
                }
            }

            loadSavedTheme() {
                const savedTheme = localStorage.getItem('alsham-quantum-theme');
                if (savedTheme) {
                    this.switchTheme(savedTheme);
                }
            }
        }

        // ===== NEURAL CHART SYSTEM =====
        function initializeNeuralChart() {
            const ctx = document.getElementById('timelineChart');
            if (!ctx) return;

            const chartData = {
                labels: ['12:00', '12:10', '12:20', '12:30', '12:40', '12:50', '13:00'],
                datasets: [
                    {
                        label: 'Neural Performance (%)',
                        data: [78, 82, 85, 81, 87, 89, 86],
                        borderColor: '#F4D03F',
                        backgroundColor: 'rgba(244, 208, 63, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Processing Cycles/min',
                        data: [6, 8, 7, 9, 11, 8, 10],
                        borderColor: '#9333EA',
                        backgroundColor: 'rgba(147, 51, 234, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }
                ]
            };

            window.neuralTimelineChart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff',
                                font: {
                                    family: 'Inter',
                                    size: 12
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#ffffff', font: { size: 10 } }
                        },
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#ffffff', font: { size: 10 } },
                            beginAtZero: true,
                            max: 100
                        },
                        y1: {
                            type: 'linear',
                            display: false,
                            position: 'right'
                        }
                    }
                }
            });
        }

        // ===== MODAL SYSTEM WITH REAL DATA =====
        async function openAgentModal(agentType) {
            const modal = document.getElementById('agent-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');
            
            if (!modal || !title || !body) return;

            // Show loading state
            title.textContent = 'Loading Neural Agent Data...';
            body.innerHTML = '<div class="text-center py-8"><i class="fas fa-spinner fa-spin text-2xl"></i><p class="mt-4">Accessing neural network...</p></div>';
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');

            try {
                // Fetch real data from WebSocket manager
                let realMetrics = {};
                if (window.quantumWebSocketManager) {
                    realMetrics = await window.quantumWebSocketManager.fetchAgentDetails(agentType);
                }

                const agentConfig = {
                    core: {
                        title: 'üîß Core Intelligence - Neural Processing Engine',
                        description: 'Advanced quantum-powered neural processing system responsible for continuous optimization and intelligent decision-making within the ALSHAM QUANTUM platform.',
                        capabilities: [
                            'Quantum Machine Learning algorithms with Bayesian optimization',
                            'Real-time hyperparameter tuning and model selection',
                            'Dynamic feature engineering with neural networks',
                            'Automated model architecture optimization',
                            'Performance monitoring and predictive analytics'
                        ]
                    },
                    learn: {
                        title: 'üß† Learning Engine - Adaptive Neural Networks',
                        description: 'Self-evolving learning system with advanced neural architectures for continuous improvement and adaptation within the ALSHAM QUANTUM ecosystem.',
                        capabilities: [
                            'Deep Learning with quantum-enhanced neural networks',
                            'Transfer Learning with enterprise-grade adaptation',
                            'Meta-learning for rapid model convergence',
                            'Neural Architecture Search with quantum optimization',
                            'Continual Learning with catastrophic forgetting prevention'
                        ]
                    },
                    guard: {
                        title: 'üõ°Ô∏è Security Matrix - Enterprise Protection System',
                        description: 'Comprehensive security and monitoring system with quantum-enhanced threat detection for enterprise-grade protection of the ALSHAM QUANTUM platform.',
                        capabilities: [
                            'Quantum-powered anomaly detection algorithms',
                            'Real-time threat intelligence and analysis',
                            'Behavioral analysis with machine learning',
                            'Automated incident response and recovery',
                            'Enterprise security policy enforcement'
                        ]
                    }
                };

                const agent = agentConfig[agentType];
                if (!agent) return;

                title.textContent = agent.title;
                
                body.innerHTML = `
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-2">System Overview</h4>
                        <p class="text-sm opacity-90">${agent.description}</p>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-3">Neural Capabilities</h4>
                        <ul class="space-y-2">
                            ${agent.capabilities.map(cap => `
                                <li class="flex items-center text-sm">
                                    <i class="fas fa-check-circle mr-2 text-green-400"></i>
                                    ${cap}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-3">Real-time Metrics</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${Object.entries(realMetrics).map(([key, value]) => `
                                <div class="glass-card p-3">
                                    <div class="text-xs opacity-75">${key}</div>
                                    <div class="text-lg font-bold orbitron">${value}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="flex justify-end">
                        <button onclick="closeModal()" class="btn">Close Neural Interface</button>
                    </div>
                `;

                const closeBtn = modal.querySelector('button');
                if (closeBtn) closeBtn.focus();

                if (window.quantumSoundDesign) {
                    window.quantumSoundDesign.play('success');
                }

            } catch (error) {
                console.error('Error loading agent data:', error);
                body.innerHTML = `
                    <div class="text-center py-8 text-red-400">
                        <i class="fas fa-exclamation-triangle text-2xl mb-4"></i>
                        <p>Neural network temporarily unavailable</p>
                        <p class="text-sm opacity-75 mt-2">Operating in quantum simulation mode</p>
                        <button onclick="closeModal()" class="btn mt-4">Close Interface</button>
                    </div>
                `;
            }
        }

        function closeModal() {
            const modal = document.getElementById('agent-modal');
            if (modal) {
                modal.classList.remove('active');
                modal.setAttribute('aria-hidden', 'true');
            }
        }

        // ===== KEYBOARD NAVIGATION =====
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
            
            const themeKeys = {
                '1': 'quantum-glass',
                '2': 'corporate-void',
                '3': 'enterprise-azure',
                '4': 'quantum-matrix',
                '5': 'platinum-executive'
            };
            
            if (themeKeys[e.key] && window.quantumThemeSystem) {
                window.quantumThemeSystem.switchTheme(themeKeys[e.key]);
            }
        });

        // ===== QUANTUM PERFORMANCE MONITORING =====
        class QuantumPerformanceMonitor {
            constructor() {
                this.metrics = {
                    loadTime: 0,
                    renderTime: 0,
                    memoryUsage: 0
                };
                this.init();
            }

            init() {
                window.addEventListener('load', () => {
                    this.metrics.loadTime = performance.now();
                    console.log(`üìä ALSHAM QUANTUM loaded in ${this.metrics.loadTime.toFixed(2)}ms`);
                });

                if (performance.memory) {
                    setInterval(() => {
                        this.metrics.memoryUsage = performance.memory.usedJSHeapSize;
                    }, 10000);
                }

                this.observeQuantumVitals();
            }

            observeQuantumVitals() {
                if ('PerformanceObserver' in window) {
                    const lcpObserver = new PerformanceObserver((list) => {
                        const entries = list.getEntries();
                        const lcp = entries[entries.length - 1];
                        console.log(`üìä Quantum LCP: ${lcp.startTime.toFixed(2)}ms`);
                    });
                    lcpObserver.observe({ entryTypes: ['largest-contentful-paint'] });

                    const fidObserver = new PerformanceObserver((list) => {
                        const entries = list.getEntries();
                        entries.forEach(entry => {
                            console.log(`üìä Quantum FID: ${entry.processingStart - entry.startTime}ms`);
                        });
                    });
                    fidObserver.observe({ entryTypes: ['first-input'] });
                }
            }
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Initializing ALSHAM QUANTUM Enterprise Platform...');

            // Initialize quantum systems
            window.quantumSoundDesign = new QuantumSoundDesign();
            window.quantumThemeSystem = new QuantumThemeSystem();
            window.businessInsights = new BusinessInsights();
            window.quantumWebSocketManager = new QuantumWebSocketManager();
            window.quantumPerformanceMonitor = new QuantumPerformanceMonitor();

            // Initialize quantum particles
            try {
                window.quantumParticlesSystem = new QuantumParticlesSystem();
            } catch (error) {
                console.warn('Three.js not available, quantum particles disabled:', error);
            }

            // Initialize neural chart
            initializeNeuralChart();

            // Add touch optimization
            document.addEventListener('touchstart', () => {}, { passive: true });

            // Add quantum sound interactions
            document.addEventListener('click', (e) => {
                if (e.target.matches('button, .btn, .card-3d, .theme-btn, .event-item')) {
                    if (window.quantumSoundDesign) {
                        window.quantumSoundDesign.play('click');
                    }
                }
            });

            document.addEventListener('mouseenter', (e) => {
                if (e.target.matches('.card-3d, .theme-btn, button, .btn')) {
                    if (window.quantumSoundDesign) {
                        window.quantumSoundDesign.play('hover');
                    }
                }
            }, true);

            // Handle visibility changes
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    console.log('üì± ALSHAM QUANTUM minimized');
                } else {
                    console.log('üì± ALSHAM QUANTUM active');
                }
            });

            console.log('‚úÖ ALSHAM QUANTUM Enterprise Platform initialized successfully!');
        });

        // ===== CLEANUP =====
        window.addEventListener('beforeunload', () => {
            if (window.quantumWebSocketManager) {
                window.quantumWebSocketManager.destroy();
            }
            if (window.quantumParticlesSystem) {
                window.quantumParticlesSystem.destroy();
            }
        });

        // ===== ERROR HANDLING =====
        window.addEventListener('error', (e) => {
            console.error('‚ùå ALSHAM QUANTUM error:', e.error);
            
            // Less intrusive error handling
            console.warn('üîß Quantum error recovery protocols activated');
            
            if (window.quantumSoundDesign) {
                window.quantumSoundDesign.play('error');
            }
        });

        // ===== QUANTUM READY EVENT =====
        document.dispatchEvent(new CustomEvent('quantumReady', {
            detail: {
                version: '2.0.0',
                timestamp: Date.now(),
                system: 'ALSHAM QUANTUM',
                company: 'ALSHAM GLOBAL COMMERCE',
                features: [
                    'PWA Enterprise',
                    'Offline Support',
                    'Push Notifications',
                    'Quantum Particles',
                    'Real-time Neural Data',
                    'Quantum Theme System',
                    'Enterprise Sound Design',
                    'Performance Monitoring',
                    'Neural Network Integration'
                ]
            }
        }));
    </script>
</body>
</html>
